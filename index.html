<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lineup Experiment</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <link rel="stylesheet" href="jspsych/jspsych.css" type="text/css">
</head>
<body>
</body>
<script>

  // Getting FPS
  if (!window.requestAnimationFrame) {
        window.requestAnimationFrame =
            window.mozRequestAnimationFrame ||
            window.webkitRequestAnimationFrame;
    }

    let prevTime = performance.now();
    let frameCount = 0;
    let animateAnimationFrameId = null;

    function animate(now) {
        const currentTime = performance.now();
        const deltaTime = currentTime - prevTime;
        frameCount++;

        if (deltaTime >= 1000) {
            const fps = Math.round((frameCount * 1000) / deltaTime);
            frameCount = 0;
            prevTime = currentTime;

            const fpsContainer = document.querySelector('.fps');
            if (fpsContainer) {
                fpsContainer.innerHTML = `FPS: ${fps}`;
            }
        }

        animateAnimationFrameId = requestAnimationFrame(animate);
    }

    // Start the FPS calculation loop
    animateAnimationFrameId = requestAnimationFrame(animate);

    function startExperiment() {
        const jsPsych = initJsPsych({
            use_webaudio: false,
            on_finish: function () {
                jsPsych.data.displayData();
            },
        });

        let timeline = [];
        const welcome = {
            type: jsPsychHtmlKeyboardResponse,
            choices: [' '],
            stimulus: `<h1>Welcome to this experiment!</h1>`,
            trial_duration: 4000,
        };
        timeline.push(welcome);

        const instructions = {
            type: jsPsychHtmlKeyboardResponse,
            choices: [' '],
            stimulus: `
                <h1>Instructions</h1><br>
                <p>You will now be presented with a series of photos.
                Please pay close attention to these faces.
                Your memory for the faces will be assessed later in the experiment.</p><br>
                <aside>Please press the spacebar to begin</aside><br>
                <div class='fps'></div>`,
        };

        timeline.push(instructions);

        jsPsych.run(timeline);
    }

    window.onload = startExperiment;
</script>
</html>